{% extends('base.html.twig') %}

{% block content %}
    <br />
    <div align="center">
        <table class="design">
            <tr>
                <th><label for="trainTableIndex">{{ 'general.input.index' | trans }}</label></th>
                <td>
                    <select id="trainTableIndex" name="trainTableIndex">
                        {% for trainTableIndex in trainTableIndices %}
                            <option {{ trainTableIndexNumber == trainTableIndex.id ? "selected=\"selected\"" : '' }} value="{{ trainTableIndex.id }}">{{ trainTableIndex.name }}</option>
                        {% endfor %}
                    </select>
                </td>
            </tr>
            <tr>
                <th><label for="dayNumber">{{ 'general.input.dayNumber' | trans }}</label></th>
                <td>
                    <select id="dayNumber" name="dayNumber">
                        {% for dayNumberSelect in 0..6 %}
                            <option {{ dayNumber == dayNumberSelect ? 'selected="selected" ' }}value="{{ dayNumberSelect }}">{{ ('general.date.days.' ~ dayNumberSelect) | trans }}</option>
                        {% endfor %}
                    </select>
                </td>
            </tr>
            <tr>
                <th><label for="location">{{ 'general.input.location' | trans }}</label></th>
                <td>
                    <input id="location" maxlength="8" name="location" size="10" type="text" value="{{ locationName }}" />
                    <span id="location_description"></span>
                </td>
            </tr>
            <tr>
                <th><label for="startTime">{{ 'passingRoutes.input.timeRange' | trans | raw }}</label></th>
                <td>
                    <input id="startTime" maxlength="5" name="startTime" size="8" type="text" value="{{ startTime }}" />
                    <input id="endTime" maxlength="5" name="endTime" size="8" type="text" value="{{ endTime }}" />
                </td>
            </tr>
            <tr>
                <th>&nbsp;</th>
                <td><a class="somda-button" href="#" id="searchPassingRoutes" onclick="searchPassingRoutes(); return false;" title="{{ 'passingRoutes.input.button' | trans }}">{{ 'general.button.search' | trans }}</a></td>
            </tr>
        </table>
        <br />

        {% if passingRoutes | length %}
            <table class="design">
                <tr>
                    <th>{{ 'general.output.time' | trans }}</th>
                    <th>{{ 'general.output.route' | trans }}</th>
                    <th>{{ 'general.output.characteristic' | trans }}</th>
                    <th>{{ 'general.output.startLocation' | trans }}</th>
                    <th>{{ 'general.output.action' | trans }}</th>
                    <th>{{ 'general.output.endLocation' | trans }}</th>
                </tr>
                {% for trainTable in passingRoutes %}
                    <tr>
                        <td>{{ trainTable['time'] | displayTime }}</td>
                        <td><a href="{{ path('train_table_search', {'trainTableYearId': trainTableIndexNumber, 'routeNumber': trainTable['route_number'] }) }}">{{ trainTable['route_number'] }}</a></td>
                        <td>{{ trainTable[constant('App\\Repository\\TrainTable::FIELD_TRANSPORTER_NAME')] }} - {{ trainTable[constant('App\\Repository\\TrainTable::FIELD_CHARACTERISTIC_DESCRIPTION')] }}</td>
                        <td><a title="{{ trainTable['fl_first_description'] }}">{{ trainTable['fl_first_name'] }}</a></td>
                        <td>{{ ("general.action." ~ trainTable['action']) | trans }}</td>
                        <td><a title="{{ trainTable['fl_last_description'] }}">{{ trainTable['fl_last_name'] }}</a></td>
                    </tr>
                {% endfor %}
            </table>
        {% endif %}
    </div>
{% endblock %}

{% block javascripts %}
    <script>
        $(document).ready(function() {
            $('#location').autocomplete({
                source: function(request, response) {
                    $.ajax({
                        url: '{{ path('location_json', { 'search': '1234' }) }}'.replace('1234', request.term),
                        dataType: 'json',
                        success: function(data) {
                            response(data);
                        }
                    });
                },
                minLength: 2,
                select: function (event, ui) {
                    $('#location_description').html(ui.item.description);
                }
            }).on('change', function () {
                $.ajax({
                    url: '{{ path('location_json', { 'search': '1234' }) }}'.replace('1234', $(this).val()),
                    dataType: 'json',
                    success: function(data) {
                        if (data.length === 1) {
                            $('#location_description').html(data[0].description);
                        } else {
                            $('#location_description').html('Locatie niet gevonden');
                        }
                    },
                });
            });
        });

        function searchPassingRoutes() {
            let location = '{{ path('passing_routes_search', { 'trainTableYearId': 9999, 'locationName': 'locationName', 'dayNumber': 1234, 'startTime': 'startTime', 'endTime': 'endTime' }) }}';
            location = location.replace('9999', $('#trainTableIndex').val());
            location = location.replace('locationName', $('#location').val());
            location = location.replace('1234', $('#dayNumber').val());
            location = location.replace('startTime', $('#startTime').val());
            location = location.replace('endTime', $('#endTime').val());
            document.location = location;
        }
    </script>
{% endblock %}
